{% extends 'base.html' %}
{% load static %}
{% block content %}
{% load humanize %}

<!-- JOB SINGLE START -->
<section class="section">
    <div class="container">
        <div class="row">
            <div class="col-lg-8 col-md-7">
                <div class="job-detail border rounded p-4">
                    {% if job.image %}
                        <img src="{{ job.image.url }}" alt="{{ job.title }} Image" class="img-fluid w-25 float-left mx-auto d-block">
                    {% elif job.company.image %}
                        <img src="{{ job.company.image.url }}" alt="{{ job.company.name }} Logo" class="img-fluid w-25 text-left mx-auto d-block">
                    {% endif %}
                    <div class="job-detail-content">
                        <div class="job-detail-com-desc overflow-hidden d-block">
                            <h4 class="mb-2"><a href="#" class="text-dark">{{ job.title }}</a></h4>
                            <p class="text-muted mb-0"><i class="mdi mdi-link-variant mr-2"></i>{{ job.company.name }}</p>
                            <p class="text-muted mb-0"><i class="mdi mdi-information-variant mr-2"></i>{{ job.work_mode|title }}</p>
                            <p class="text-muted mb-0"><i class="mdi mdi-map-marker mr-2"></i>{{ job.city }}, {{ job.state }}</p>
                            <p class="text-muted mb-0"><i class="mdi mdi-comment-question-outline mr-1"></i> Is available: 
                                <span class="badge badge-{% if job.is_available %}success{% else %}danger{% endif %}">
                                    {{ job.is_available|yesno:"Available,Not Available" }}
                                </span>
                            </p>
                        </div>
                    
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-12">
                        <h5 class="text-dark mt-4">Job Description :</h5>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-12">
                        <div class="job-detail border rounded mt-2 p-4">
                            <div class="job-detail-desc">
                                <p class="text-muted mb-0">{{ job.description }}</p>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-12">
                        <h5 class="text-dark mt-4 mb-0">Qualifications and Experience :</h5>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-12">
                        <div class="job-detail border rounded mt-2 p-4">
                            <div class="job-detail-desc">
                                <p class="text-muted mb-0">{{ job.edu_level }}</p>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row">
                    <div class="col-lg-12">
                        <h5 class="text-dark mt-4 mb-0">Experience :</h5>
                    </div>
                </div>

                <div class="row">
                    <div class="col-lg-12">
                        <div class="job-detail border rounded mt-2 p-4">
                            <div class="job-detail-desc">
                                <p class="text-muted mb-0">{{ job.experience }}</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-lg-4 col-md-5 mt-4 mt-sm-0 pt-2 pt-sm-0">
                <div class="company-brand-logo text-center">
                    <img src="{{ job.company.image.url }}" alt="{{ job.company.name }} Logo" class="img-fluid w-25 mx-auto d-block mb-2"> <!-- Removed float-center -->
                    <h5 class="text-muted mb-0"><a href="#" class="text-muted"><i class="mdi mdi-bank mr-1"></i>{{ job.company.name }}</a></h5>
                </div>                

                <div class="job-detail rounded border job-overview mt-4 mb-4">
                    <div class="single-post-item mb-4">
                        <div class="float-left mr-3">
                            <i class="mdi mdi-currency-usd text-muted mdi-24px"></i>
                        </div>
                        <div class="overview-details">
                            <h6 class="text-muted mb-0">Salary</h6>
                            <h6 class="text-black-50 pt-2 mb-0">NRs. {{ job.salary|intcomma }}</h6>
                        </div>
                    </div>

                    <div class="single-post-item mb-4">
                        <div class="float-left mr-3">
                            <i class="mdi mdi-apps text-muted mdi-24px"></i>
                        </div>
                        <div class="overview-details">
                            <h6 class="text-muted mb-0">Category</h6>
                            <h6 class="text-black-50 pt-2 mb-0">{{ job.category.name }}</h6>
                        </div>
                    </div>

                    <div class="single-post-item mb-4">
                        <div class="float-left mr-3">
                            <i class="mdi mdi-calendar-today text-muted mdi-24px"></i>
                        </div>
                        <div class="overview-details">
                            <h6 class="text-muted mb-0">Date Posted</h6>
                            <h6 class="text-black-50 pt-2 mb-0">{{ job.uploaded_date }}</h6>
                        </div>
                    </div>

                    <div class="single-post-item mb-4">
                        <div class="float-left mr-3">
                            <i class="mdi mdi-email text-muted mdi-24px"></i>
                        </div>
                        <div class="overview-details">
                            <h6 class="text-muted mb-0">Email</h6>
                            <h6 class="text-black-50 pt-2 mb-0">{{ job.email }}</h6>
                        </div>
                    </div>

                    <div class="single-post-item">
                        <div class="float-left mr-3">
                            <i class="mdi mdi-phone-classic text-muted mdi-24px"></i>
                        </div>
                        <div class="overview-details">
                            <h6 class="text-muted mb-0">Contact No</h6>
                            <h6 class="text-black-50 pt-2 mb-0">{{ job.contact }}</h6>
                        </div>
                    </div>
                </div>                
                <div class="mt-4">
                    {% if a_applicant %}
                    {% if not a_applicant.has_resume %}
                        <form action="{% url 'update-resume' request.user.resume.pk %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-primary btn-block btn-sm">
                                <i class="mdi mdi-send mr-2"></i> Create Resume First
                            </button>
                        </form>
                    {% elif a_applicant.has_resume and not has_applied %}
                        <form action="{% url 'apply' job.pk %}" method="post">
                            {% csrf_token %}
                            <button type="submit" class="btn btn-primary btn-block btn-sm">
                                <i class="mdi mdi-send mr-2"></i> Apply This Job
                            </button>
                        </form>
                    {% else %}
                        <p class="text-success text-center">You have already applied for this job.</p>
                    {% endif %}
                    
                    {% elif a_recruiter %}
                    <div class="text-center">
                        <a href="{% url 'update-job' job.pk %}" class="btn btn-primary">
                            <i class="mdi mdi-tooltip-edit"></i> Update Details
                        </a>
                    </div>
                    {% else %}
                    <div class="text-center mt-3">
                        <p class="text-danger">You must login to apply for this job.</p>
                        <a href="{% url 'login' %}" class="btn btn-primary"><i class="mdi mdi-login"></i> Login</a>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
</section>
<!-- JOB SINGLE END -->

{% endblock content %}